<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>RDU Service Monitoring</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <script>
	function call_api(name, url){
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
    			if (this.readyState == 4 && this.status == 200) {
				console.log(this.responseText);
				document.getElementById(name+"-res-msg").innerHTML = this.responseText;
				if ( this.responseText == "service unavialable" ){
					document.getElementById(name+"-title-id").innerHTML = '<button type="button" class="btn btn-danger btn-circle"><i class="fa fa-times"></i></button>';
					document.getElementById(name+"-res-msg").innerHTML = "Service is unavialable";
				}else{
					document.getElementById(name+"-title-id").innerHTML = '<button type="button" class="btn btn-info btn-circle"><i class="fa fa-check"></i></button>';
				}
    			}
  		};
		document.getElementById(name+"-title-id").innerHTML = '<button type="button" class="btn btn-warning btn-circle" ><i class="fa fa-refresh"></i></button>';
		document.getElementById(name+"-res-msg").innerHTML = 'checking '+name+' service...';
  		xhttp.open("POST", "call_api.php", true);
  		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  		xhttp.send("url="+url);
	}

	function check_btn(){
		console.log("Run checking");
		document.getElementById('panel-body-id').style = "display:none";
		call_api("kong", "http://164.115.35.167/api/1.0/newsgroup?apikey=2f8fef4a82ff4d10b58670c655d8c591");	
		call_api("api", "http://164.115.35.168/uhosnetapi/api/1.0/newsgroup?apikey=2f8fef4a82ff4d10b58670c655d8c591");	
		call_api("db", "http://164.115.35.169/api/1.0/newsgroup?apikey=2f8fef4a82ff4d10b58670c655d8c591");	
		document.getElementById('panel-body-id').style = "display:inline";
		//after run success
		//document.getElementById('kong-res-msg').innerHTML = "service is ok!";
		//document.getElementById('api-res-msg').innerHTML = "service is ok!";
		//document.getElementById('cms-res-msg').innerHTML = "service is ok!";
		//document.getElementById('db-res-msg').innerHTML = "service is ok!";
	}	
    </script>

</head>

<body>
<div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                           RDU Services <button type="button" onclick="check_btn()" id="check_btn" class="btn btn-success btn-circle btn-lg"><span class="glyphicon glyphicon-play"></span></button>
</div>                  <!-- .panel-heading -->
                        <div class="panel-body" id="panel-body-id" style="display:none">
                            <div class="panel-group" id="accordion">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" class="collapsed">Kong Service</a> <a id="kong-title-id"></a>
                                        </h4>
                                    </div>
                                    <div id="collapseOne" class="panel-collapse collapse" aria-expanded="false" style="">
                                        <div class="panel-body" id="kong-res-msg"></div>
                                    </div>
                                </div>
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" class="collapsed" aria-expanded="false">API Service</a> <a id="api-title-id"></a> 
                                        </h4>
                                    </div>
                                    <div id="collapseTwo" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
                                        <div class="panel-body" id="api-res-msg"></div>
                                    </div>
                                </div>
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title" >
                                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" class="collapsed" aria-expanded="false">Database Service</a> <a id="db-title-id"></a> 
                                        </h4>
                                    </div>
                                    <div id="collapseThree" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
                                        <div class="panel-body" id="db-res-msg"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- .panel-body -->
                    </div>
                    <!-- /.panel -->
                </div>
<script src="vendor/jquery/jquery.min.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!-- Metis Menu Plugin JavaScript -->
<script src="vendor/metisMenu/metisMenu.min.js"></script>
<!-- Custom Theme JavaScript -->
<script src="dist/js/sb-admin-2.js"></script>
</body>
</html>
